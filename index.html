<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>Future Tech Academy</title>
    <link rel="icon" type="image/x-icon" href="images/icon.webp">

    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/media.css">
</head>

<body>

    <div id="app">
        <header>
            <!-- Navigation Bar -->
            <nav v-show="showNavBar">
                <!-- School Logo -->
                <figure>
                    <img v-bind:src="imageLink(school.logo)" alt="logo"
                        style="width: 120px; height: 100px; background-color: none;" />
                </figure>
        
                <div class="navigation">
                    <!-- Search Box -->
                    <div id="search-box">
                        <!-- Search Icon -->
                        <i class="fas fa-search search-icon"></i>
                        <!-- Input for search functionality, linked to the `searchQuery` Vue data property -->
                        <input type="text" name="search" placeholder="Search Courses" v-model="searchQuery"
                            id="search-area">
                    </div>
        
                    <!-- Navigation Links -->
                    <ul>
                        <!-- Close Menu Button (Mobile) -->
                        <i id="menu-close" class="fa-solid fa-x"></i>
                        <li><a href="#" v-on:click="showHome">Home</a></li>
                        <li><a href="#" @click="showCourses">Courses</a></li>
                        <!-- Displays "About" info on hover -->
                        <li>
                            <a @mouseover="showAbout = true" @mouseleave="showAbout = false" class="nav-item">About</a>
                        </li>
                        <!-- Displays "Contact" info on hover -->
                        <li>
                            <a @mouseover="showContact = true" @mouseleave="showContact = false" class="nav-item">Contact</a>
                        </li>
        
                        <!-- Cart/Checkout Button -->
                        <!-- Only shown if `showCartButton` is true -->
                        <button id="checkout_button" v-on:click="showCheckout" v-show="showCartButton">
                            &nbsp;<i class="fa-solid fa-cart-shopping"></i>&nbsp;{{ cartItemCount }}
                        </button>
                    </ul>
        
                    <!-- Menu Button (Mobile) -->
                    <img id="menu-btn" :src="imageLink('images/menu1.jpg')" alt="menu-btn">
                </div>
            </nav>
        
            <!-- Contact Info Box -->
            <!-- Displays contact information when hovered -->
            <div @mouseover="showContact = true" @mouseleave="showContact = false" id="contact-info"
                v-show="showContact" class="info-box">
                <h3 class="contact-us">Contact Us</h3>
                <!-- Contact Details -->
                <p><strong>Customer Support Hotline:</strong> <a href="tel:+123456789">+971563636822</a></p>
                <p><strong>Business Hours:</strong><br>Monday - Friday: 9:00 AM - 6:00 PM<br>Saturday: 10:00 AM - 4:00 PM</p>
                <p><strong>For SMS Support:</strong> <a href="sms:123">"123"</a></p>
                <p><strong>Email Us:</strong> <a href="mailto:someone@example.com">Kabeerkumar577@gmail.com</a></p>
        
                <!-- Social Media Links -->
                <h4>Connect with Us:</h4>
                <ul style="list-style-type: none; padding: 0;">
                    <li><a href="https://facebook.com/yourpage" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                    <li><a href="https://twitter.com/yourprofile" target="_blank"><i class="fab fa-instagram"></i></a></li>
                    <li><a href="https://linkedin.com/company/yourcompany" target="_blank"><i class="fab fa-linkedin-in"></i></a></li>
                </ul>
            </div>
        
            <!-- About Info Box -->
            <!-- Displays "About Us" information when hovered -->
            <div @mouseover="showAbout = true" @mouseleave="showAbout = false" id="about-info" v-show="showAbout"
                class="about-box">
                <h3 class="About">About Us</h3>
                <h3 class="kabeer">Kabeer Kumar</h3>
                <div class="about-profile">
                    <!-- Profile Image -->
                    <img :src="imageLink('images/profile1.jpg')" alt="Profile Picture"
                        @mouseover="showProfileMessage = true" @mouseleave="showProfileMessage = false"
                        id="profile-image" />
                    
                    <!-- About Us Description -->
                    <p>Welcome to Future Academy, a premier destination for top-rated courses that help you grow and
                        excel in various fields. Our mission is to provide high-quality, accessible education that
                        equips students with practical skills and knowledge for their future careers.</p>
                    <p>We offer a diverse range of courses taught by experienced professionals who are passionate about
                        teaching and committed to your success. With a focus on hands-on learning, we ensure you gain
                        the confidence to apply what you learn in real-world scenarios.</p>
                    <p>Whether you're starting your career or looking to expand your skill set, Future Academy is here
                        to support your educational journey. Join us and unlock your potential with a learning
                        experience that’s designed just for you.</p>
                </div>
            </div>
        </header>

        <main>
            <!-- Main section is displayed only if 'showProduct' is true -->
            <section id="main-section" v-if="showProduct">
            
                <!-- Home Section -->
                <section id="home" v-if="showHomeContent">
                    <!-- Displayed only if 'showHomeContent' is true -->
                    <h2>Unlock innovation with the power of technology education</h2>
                    <p>
                        Technology is not just a tool, it’s a gateway to innovation, creativity, and a better future. 
                        By investing in tech education, we invest in a future where everyone has the potential to contribute 
                        to meaningful change and drive progress.
                    </p>
                    <div class="btn">
                        <a class="learn" href="#">Learn More</a>
                        <a class="courses" href="#" @click="showCourses">Visit Courses</a>
                    </div>
                </section>
            
                <!-- Sort and Filter Section -->
                <section v-if="showCoursesOnly && sortedFilteredProducts.length > 0" id="sort-toggle-section">
                    <!-- Displayed only if 'showCoursesOnly' is true and there are products to show -->

                    <button @click="toggleSortSection" class="sort-toggle-btn">Filter By</button>
                    <!-- Toggles visibility of the sorting/filter options -->

                    <div class="sort-options" v-show="showSortSection">
                        <!-- Sorting and filtering options, displayed when 'showSortSection' is true -->

                        <div class="tags">
                            <span class="close-tag" v-on:click="closeSortSection">
                                <i class="fa-solid fa-circle-xmark"></i>
                            </span>
                        </div>
                        <h2>Sort & Filter<i class="fa-solid fa-filter"></i></h2>
                        <select v-model="sortBy">
                            <option value="">Sort by</option>
                            <option value="title">Name</option>
                            <option value="availableInventory">Availability</option>
                            <option value="price">Price</option>
                            <option value="location">Location</option>
                        </select>
                        <select v-model="sortOrder">
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>
                </section>

                <h1 id="title" v-text="sitename"></h1>
            
                <!-- Products Section -->
                <section id="products-section">
                    <!-- Loop through the filtered and sorted product list -->
                    <div v-for="product in sortedFilteredProducts" :key="product.id" class="product-item">
                        <!-- Each product is displayed in its own 'product-item' container -->
            
                        <div v-if="showImageModal" class="modal-overlay" @click="closeImageModal">
                            <!-- Displayed only if 'showImageModal' is true -->
                            <div class="modal-content" @click.stop>
                                <!-- Modal content, clicking inside stops the event propagation -->
                                <span class="close-btn" @click="closeImageModal">&times;</span>
                                <img :src="imageLink(currentImage)" alt="Product image" class="modal-image">
                            </div>
                        </div>
            
                        <!-- Product Image -->
                        <figure @click="openImageModal(product.image)">
                            <img :src="imageLink(product.image)" alt="Product image">
                            <!-- Product image fetched dynamically -->
                        </figure>
            
                        <!-- Product Details -->
                        <section id="modules">
                            <h2 class="product-item">{{ product.title }}</h2>
                            <p class="product-item product-location">{{ product.location }}</p>
                            <p v-if="product.availableInventory > 0">In stock: {{ product.availableInventory }}</p>
                            <!-- Displays stock availability if inventory is greater than 0 -->
                            <p v-else class="out-of-stock">Out of stock</p>
                            <!-- Displays "Out of stock" if inventory is 0 -->
                            <p class="rating">{{ "★".repeat(product.stars) }} ({{ product.rating }})</p>
                            <p class="price">${{ product.price }}</p>
                            <!-- Product price -->
                            <button @click="addToCart(product)" :disabled="product.availableInventory === 0" class="add-button">
                                <!-- Add to Cart button, disabled if inventory is 0 -->
                                <i class="fas fa-cart-plus"></i>
                            </button>
                        </section>
                    </div>
            
                    <!-- Message for No Matching Products -->
                    <p v-if="sortedFilteredProducts.length === 0" class="no-match-message">
                        No match found for your search.
                    </p>
                </section>

                <!-- Register Form -->
                <section id="register" v-if="showRegisterForm">
                    <div class="reminder">
                        <h1>Register To Get It</h1>
                    </div>
                    <div class="form">
                        <h3>Create Free Account Now</h3>
                        <input type="text" placeholder="Name" name="" id="">
                        <input type="text" placeholder="Email" name="" id="">
                        <input type="text" placeholder="Phone Number" name="" id="">
                        <div class="btn">
                            <a class="learn" href="#" @click.prevent="submitForm">Submit Form</a>
                        </div>
                    </div>
                </section>
                <!-- Register Form End-->
                <!-- Profile Form -->
                <section id="creater" v-if="showHomeContent">
                    <h1>Creater</h1>
                    <p>I’m a 3rd-year IT student at Middlesex University,
                        and this website is part of a project for my course</p>
                    <div class="creater-box">
                        <div class="profile">
                            <img :src="imageLink('images/profile1.jpg')" alt="">
                            <h6>Kabeer Kumar</h6>
                            <p>HTML Websites Creater</p>
                            <div class="pro-links">
                                <i class="fab fa-facebook-f"></i>
                                <i class="fab fa-instagram"></i>
                                <i class="fab fa-linkedin-in"></i>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Profile Form -->
            </section>

            <!-- Courses Form End-->
            <div v-else>
                <!-- Cart Section: Displays if form and thank-you page are not shown -->
                <section v-if="!showForm && !showThankYouPage" id="cart-section">
                    <!-- Back to shop button -->
                    <button @click="goToCourses" class="back-to-shop-btn">
                        <i class="fa-solid fa-arrow-left"></i>Back To Shop
                    </button>
                    <h2 class="title1">Your Cart <i class="fa-solid fa-cart-shopping"></i></h2>
            
                    <!-- Cart Items Loop -->
                    <div>
                        <div v-for="item in cartItems" :key="item.id" class="cart-product">
                            <!-- Product Image -->
                            <figure class="cart-product-figure">
                                <img :src="imageLink(item.image)" class="cart-product-img" alt="Product image">
                            </figure>
                            <div class="cart-product-info">
                                <!-- Product Details -->
                                <h2 class="cart-product-title">{{ item.title }}</h2>
                                <p class="cart-product-location">{{ item.location }}</p>
                                
                                <!-- Quantity Controls -->
                                <div class="cart-product-subsection">
                                    <div class="cart-product-quantity">
                                        <!-- Decrease Quantity Button -->
                                        <button @click="subtractFromCart(item)" class="quantity-button" 
                                            :disabled="item.orderedQuantity === 0">-</button>
                                        <p class="cart-product-count">{{ item.orderedQuantity }}</p>
                                        <!-- Increase Quantity Button -->
                                        <button @click="addToCart(item)" class="quantity-button" 
                                            :disabled="item.availableInventory === 0">+</button>
                                    </div>
                                    <p class="cart-product-rate">${{ item.price }}</p>
                                    <!-- Remove Item from Cart -->
                                    <p v-on:click="removeFromCart(item)" class="remove">
                                        <i class="fa-solid fa-trash"></i>
                                    </p>
                                </div>
                            </div>
                            <!-- Total Price for the Item -->
                            <div>
                                <p class="cart-product-price">${{ item.price * item.orderedQuantity }}</p>
                            </div>
                        </div>
                    </div>
            
                    <!-- Price Overview Section -->
                    <div id="price-overview">
                        <h3 class="title">Subtotal</h3>
                        <hr class="po-line">
                        <span class="po-span">
                            <p class="po-text">SUBTOTAL</p>
                            <p class="price-text">${{ cartSubtotal.toFixed(2) }}</p>
                        </span>
                        <span class="po-span">
                            <p class="po-text">TAX</p>
                            <p class="price-text">$0.00</p>
                        </span>
                        <span class="po-span-2">
                            <p class="po-text">TOTAL</p>
                            <p class="price-text">${{ cartSubtotal.toFixed(2) }}</p>
                        </span>
                        <!-- Proceed to Checkout Button -->
                        <a href="#checkout-form">
                            <button v-on:click="showFormSection()" id="ptcButton">PROCEED TO CHECKOUT</button>
                        </a>
                    </div>
                </section>
            
                <!-- Thank You Page: Displays after order is placed -->
                <section v-if="showThankYouPage" id="thank-you-section">
                    <div class="thank-you-message">
                        <i class="fa-solid fa-check-circle"></i>
                        <h2>Thank you for shopping!</h2>
                        <button class="btn-home" @click="goToHome">Back to Home</button>
                    </div>
                </section>
            
                <!-- Checkout Form Section -->
                <section v-if="!showThankYouPage && showForm" id="checkout-section">
                    <div id="checkout-form">
                        <h3 class="title">Checkout Form <i class="fa-solid fa-bag-shopping"></i></h3>
                        <h4>Billing Address</h4>
                        
                        <!-- Input Fields with Validation -->
                        <!-- First Name -->
                        <input v-model.trim="order.firstName" :key="shakeKeyFirstName" type="text" placeholder="First Name"
                            :class="{'invalid-input': order.firstName && !isFirstNameValid}" class="form-input">
                        <p v-if="order.firstName && !isFirstNameValid" class="error">
                            First name must contain only letters.
                        </p>
            
                        <!-- Last Name -->
                        <input v-model.trim="order.lastName" :key="shakeKeyLastName" type="text" placeholder="Last Name"
                            :class="{'invalid-input': order.lastName && !isLastNameValid}" class="form-input">
                        <p v-if="order.lastName && !isLastNameValid" class="error">
                            Last name must contain only letters.
                        </p>
            
                        <!-- Email -->
                        <input v-model.trim="order.email" :key="shakeKeyEmail" type="email" placeholder="Email Address"
                            :class="{'invalid-input': order.email && !isEmailValid}" class="form-input">
                        <p v-if="order.email && !isEmailValid" class="error">
                            Please enter a valid email address.
                        </p>
            
                        <!-- Phone Number -->
                        <input v-model.trim="order.phone" :key="shakeKey" type="text" placeholder="Phone Number"
                            :class="{'invalid-input': order.phone && !isPhoneValid}" class="form-input">
                        <p v-if="order.phone && !isPhoneValid" class="error">
                            Phone number must contain only numbers.
                        </p>
            
                        <!-- Other Form Fields -->
                        <input v-model.trim="order.address" type="text" placeholder="Address" class="form-input">
                        <input v-model.trim="order.city" type="text" placeholder="City" class="form-input">
                        <input v-model.trim="order.zip" type="text" placeholder="Postal Code" class="form-input">
                        <select v-model="order.state" class="form-input">
                            <option disabled value="">State</option>
                            <option v-for="(state, key) in states" :value="state">{{ key }}</option>
                        </select>
            
                        <!-- Promotions Checkbox -->
                        <span class="form-span">
                            <input type="checkbox" v-model="order.promotions" :true-value="order.sendpromotions" :false-value="order.dontSendpromotions">
                            <label for="gift">promotions</label>
                        </span>
            
                        <!-- Delivery Method Radio Buttons -->
                        <span class="form-address">
                            <input type="radio" value="Home" v-model="order.method">
                            <label for="home">Home</label>
                            <input type="radio" value="Business" v-model="order.method">
                            <label for="business">Business</label>
                        </span>
            
                        <!-- Submit Button -->
                        <button class="btn2" v-if="isFormComplete" :disabled="!isFormComplete" v-on:click="submitForm1">
                            Place Order
                        </button>
                    </div>
            
                    <!-- Billing Information Overview -->
                    <div id="billing-information">
                        <figure class="receipt-figure">
                            <img v-bind:src="imageLink(school.logo)" class="receipt-img">
                        </figure>
                        <h4>Bill Overview</h4>
                        <hr class="receipt-line">
                        <span class="receipt-span">
                            <p class="bill-label">Payer Name: </p>
                            <p class="bill-answer">{{ order.firstName }} {{ order.lastName }}</p>
                        </span>
                        <span class="receipt-span">
                            <p class="bill-label">Phone Number: </p>
                            <p class="bill-answer">{{ order.phone }}</p>
                        </span>
                        <span class="receipt-span">
                            <p class="bill-label">Address: </p>
                            <p class="bill-answer">{{ order.address }}, {{ order.city }}, {{ order.state }}</p>
                        </span>
                        <span class="receipt-span">
                            <p class="bill-label">Zip: </p>
                            <p class="bill-answer">{{ order.zip }}</p>
                        </span>
                        <span class="receipt-span">
                            <p class="bill-label">promotions: </p>
                            <p class="bill-answer">{{ order.promotions }}</p>
                        </span>
                        <span class="receipt-span">
                            <p class="bill-label">Method: </p>
                            <p class="bill-answer">{{ order.method }}</p>
                        </span>
                        <hr class="receipt-line">
                        <span class="receipt-span">
                            <p class="bill-label">Product - qty:</p>
                            <p class="bill-answer">Amount</p>
                        </span>
                        <span v-for="item in cartItems" :key="item.id" class="receipt-span">
                            <p class="bill-label">{{ item.title }} - {{item.orderedQuantity}}</p>
                            <p class="bill-answer">${{ (item.price * item.orderedQuantity).toFixed(2) }}</p>
                        </span>
                        <hr class="receipt-line">
                        <span class="receipt-span">
                            <p class="bill-label">Total:</p>
                            <p class="bill-answer">${{ cartSubtotal.toFixed(2)}}</p>
                        </span>
                    </div>
                </section>
            </div>
        </main>
        <!-- Footer visible when not showing only courses -->
        <footer v-if="showHomeContent">
            <div class="footer-col">
                <h3>Top Products</h3>
                <li>Virtual Labs</li>
                <li>Mentorship Programs</li>
                <li>Online Libraries</li>
                <li>Cloud Services</li>
            </div>

            <div class="footer-col">
                <h3>Quick Links</h3>
                <li>Course Catalog</li>
                <li>Admissions</li>
                <li>Student Portal</li>
                <li>Events & Workshops</li>
            </div>

            <div class="footer-col">
                <h3>Features</h3>
                <li>Industry-Driven Curriculum</li>
                <li>Experienced Faculty</li>
                <li>Job Placement Assistance</li>
                <li>Flexible Learning</li>
            </div>

            <div class="footer-col">
                <h3>Guides</h3>
                <li>Research</li>
                <li>Experts</li>
                <li>Managed Website</li>
                <li>Marketing Service</li>
            </div>

            <div class="footer-col">
                <h3>Newsletter</h3>
                <p>What’s New at Future Academy?</p>
                <div class="subscribe">
                    <input type="text" placeholder="Your Email address">
                    <a href="#" class="courses">SUBSCRIBE</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Script -->
    <script>
        let webstore = new Vue({
            el: "#app",
            data: {
                sitename: "Our Top Rated Courses",
                showRegisterForm: true,
                showContact: false,
                showAbout: false,
                showProduct: true,
                showCartButton: false,
                showHomeContent: true,
                showCoursesOnly: false,
                showSortSection: false,
                showNavBar: true,
                showForm: false,
                searchQuery: '',
                showImageModal: false,
                currentImage: '',
                school: {
                    name: 'Future Academy',
                    logo: 'images/logo1.png'
                },

                products: [],
                originalProducts: [],
                cart: [],
                showThankYouPage: false,
                order: {
                    firstName: '',
                    lastName: '',
                    phone: '',
                    address: '',
                    city: '',
                    state: '',
                    zip: '',
                    promotions: 'Subscribe to Offers',
                    sendpromotions: 'Subscribe to Offers',
                    dontSendpromotions: 'No Thanks',
                    method: 'Home',
                },
                // Key to reset first name, last name, and phone number animation
                shakeKeyFirstName: 1,
                shakeKeyLastName: 2,
                shakeKeyEmail: 3,
                shakeKeyPhone: 4,
                shakeKey: 0,
                states: {
                    DXB: "Dubai",
                    SJ: "Sharjah",
                    AD: "Abu Dhabi",
                    AM: "Ajman"
                },
                sortBy: '',
                sortOrder: 'asc',
            },
            methods: {
                showHome: function () {
                    this.showHomeContent = true;
                    this.showCoursesContent = false;
                    this.showCoursesOnly = false;
                    this.showProduct = true;
                    this.showForm = false;
                },

                showFormSection: function () {
                    if (this.cart.length > 0) {
                        this.showForm = true;
                    } else {
                        alert("Please add at least one course to the cart before proceeding to checkout.");
                        this.showProduct = true;
                        this.showSortSection = true;
                    }
                },

                showCheckout: function () {
                    this.showProduct = !this.showProduct;
                    this.showHomeContent = false;
                    this.showCoursesContent = false;
                    this.showRegisterForm = false;
                    this.showForm = false;
                },

                showCourses: function () {
                    this.showHomeContent = false;
                    this.showCoursesContent = true;
                    this.showCoursesOnly = true;
                    this.showRegisterForm = false;
                },

                openImageModal(image) {
                    this.currentImage = image;
                    this.showImageModal = true;
                },
                closeImageModal() {
                    this.showImageModal = false;
                },

                toggleSortSection() {
                    this.showSortSection = !this.showSortSection;
                },


                closeSortSection() {
                    this.showSortSection = false;
                },

                submitForm() {
                    this.showRegisterForm = false;
                },

                // Back To Shop (Courses Page) Btn
                goToCourses() {
                    this.showProduct = !this.showProduct;
                    this.sitename = sitename;
                    this.showSortSection = true;
                },

                imageLink(image) {
                    return `https://futureacademybackend.onrender.com/${image}`;
                },

                addToCart: function (product) {
                    if (product.availableInventory > 0) {
                        let cartProduct = this.cart.find(item => item._id === product._id);

                        if (cartProduct) {
                            cartProduct.orderedQuantity++; // Update cart quantity
                        } else {
                            // Push the actual reference of the product, not a shallow copy
                            this.cart.push(product);
                            product.orderedQuantity = 1; // Initialize in the product
                        }

                        product.availableInventory--; // Decrement inventory in the original product reference
                        this.showCartButton = true;
                    } else {
                        alert("Product is out of stock!");
                    }
                },


                subtractFromCart: function (product) {
                    let cartProduct = this.cart.find(item => item._id === product._id);

                    if (cartProduct && cartProduct.orderedQuantity > 0) {
                        cartProduct.orderedQuantity--;
                        product.availableInventory++; // Increment inventory for the actual product

                        if (cartProduct.orderedQuantity === 0) {
                            const index = this.cart.indexOf(cartProduct);
                            this.cart.splice(index, 1); // Remove product from cart when quantity is 0
                        }
                        this.showCartButton = this.cart.length > 0;
                    }
                },

                removeFromCart: function (product) {
                    const cartIndex = this.cart.findIndex(item => item._id === product._id);

                    if (cartIndex > -1) {
                        // Update product availability in the products array
                        const productInStore = this.products.find(item => item._id === product._id);
                        if (productInStore) {
                            // Add the ordered quantity back to available inventory
                            productInStore.availableInventory += product.orderedQuantity;
                        }

                        // Remove the product from the cart
                        this.cart.splice(cartIndex, 1);

                        // Check if the cart is now empty and update the visibility of the cart button
                        this.showCartButton = this.cart.length > 0;
                    }
                },

                submitForm1() {
                    // Extract only required fields for the order
                    const newOrder = {
                        id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                        name: `${this.order.firstName} ${this.order.lastName}`,
                        phoneNumber: this.order.phoneNumber,
                        lessonIds: this.cart.map(item => item._id),
                        numberOfSpaces: this.cart.reduce((total, item) => total + item.orderedQuantity, 0),
                        totalAmount: this.cartSubtotal,
                    };

                    // Submit the new order to the server
                    fetch("https://futureacademybackend.onrender.com/collection/orders", {
                        method: 'POST', // Set the HTTP method as 'POST'
                        headers: {
                            'Content-Type': 'application/json', // Set the data type as JSON
                        },
                        body: JSON.stringify(newOrder), // Stringify the JSON object
                    })
                        .then(response => response.json())
                        .then(responseJSON => {
                            alert("Order placed successfully!");
                            console.log("Order Response:", responseJSON);

                            // Reset cart and form after successful order
                            this.cart = [];
                            this.clearForm();
                        })
                        .catch((error) => {
                            alert("Error placing order: " + error);
                            console.error("Order Placement Error:", error);
                        });


                    this.cart.forEach(product => {
                        // Ensure availableInventory does not drop below 0
                        const newAvailability = {
                            availableInventory: Math.max(0, product.availableInventory),
                        };

                        console.log(`Updating product ${product.title} (ID: ${product._id}) with new inventory:`, newAvailability);

                        fetch(`https://futureacademybackend.onrender.com/collection/products/${product._id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newAvailability),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(`Product ${product.title} updated successfully:`, data);
                            })
                            .catch(error => {
                                console.error(`Error updating product ${product.title}:`, error);
                            });
                    });
                    alert("Order submitted!");
                    this.showThankYouPage = true;
                    this.showNavBar = false;
                    this.cart = []; // Clear cart items
                    this.clearForm(); // Reset form fields
                },

                clearForm() {
                    // Reset each field to an empty or default state
                    this.order = {
                        firstName: '',
                        lastName: '',
                        address: '',
                        city: '',
                        state: '',
                        zip: '',
                        gift: false,
                        method: 'Home',
                    };
                },
                goToHome() {
                    // Reset all relevant states for returning to the home page
                    this.showProduct = true;
                    this.showHomeContent = true;
                    this.showNavBar = true;
                    this.showCartButton = false;
                    this.showThankYouPage = false;
                },
            },

            created: function () {
                fetch('https://futureacademybackend.onrender.com/collection/products', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                    .then(response => response.json())
                    .then(responseJSON => {
                        this.products = responseJSON;
                        this.originalProducts = responseJSON;
                    })
                    .catch((error) => {
                        alert(error);
                    });

            },

            computed: {
                cartItemCount: function () {
                    return this.cart.reduce((total, cartProduct) => {
                        return total + (cartProduct.orderedQuantity || 0);
                    }, 0) || "";
                },
                cartItems() {
                    return this.cart;
                },
                cartSubtotal() {
                    return this.cart.reduce((total, item) => {
                        return total + item.price * item.orderedQuantity;
                    }, 0);
                },

                filteredProducts() {
                    return this.products.filter(product => {
                        const query = this.searchQuery.toLowerCase();
                        // Check if the title, location and price matches the query
                        const matchesTitle = product.title.toLowerCase().includes(query);
                        const matchesLocation = product.location.toLowerCase().includes(query);
                        // const matchesPrice = product.price.toString().includes(query);
                        // const matchesAvailableInventory = product.availableInventory.toString().includes(query);
                    if (!this.searchQuery) {
                        // If the search query is empty, reset products to the original list
                        return this.originalProducts;
                    }
                    const queryParam = encodeURIComponent(this.searchQuery.trim());
                    const searchUrl = `https://futureacademybackend.onrender.com/search/products?q=${queryParam}`;
                    // Fetch search results when there's a search query
                    fetch(searchUrl)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error("Failed to fetch search results");
                            }
                            return response.json();
                        })
                        .then(results => {
                            this.products = results; // Update products with the search results
                        })
                        .catch(error => {
                            console.error("Error fetching search results:", error);
                        });

                        return matchesTitle || matchesLocation;
                    });
                    return this.products; // Return the filtered products for display
                },

                isFirstNameValid() {
                    const nameRegex = /^[A-Za-z]+$/;
                    return nameRegex.test(this.order.firstName);
                },
                isLastNameValid() {
                    const nameRegex = /^[A-Za-z]+$/;
                    return nameRegex.test(this.order.lastName);
                },

                isPhoneValid() {
                    const phoneRegex = /^[0-9]+$/;
                    return phoneRegex.test(this.order.phone);
                },

                isEmailValid() { // New email validation
                    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.order.email);
                },

                isFormComplete() {
                    const nameRegex = /^[A-Za-z]+$/;

                    return (
                        nameRegex.test(this.order.firstName) &&
                        nameRegex.test(this.order.lastName) &&
                        this.isPhoneValid &&
                        this.order.address.trim() !== '' &&
                        this.order.city.trim() !== '' &&
                        this.order.zip.trim() !== '' &&
                        this.order.state.trim() !== ''
                    );
                },
                sortedFilteredProducts() {
                    const sortedArray = [...this.filteredProducts];

                    if (this.sortBy) {
                        sortedArray.sort((a, b) => {
                            let compareA = a[this.sortBy];
                            let compareB = b[this.sortBy];
                            if (typeof compareA === 'string') {
                                compareA = compareA.toLowerCase();
                                compareB = compareB.toLowerCase();
                            }

                            if (this.sortOrder === 'asc') {
                                return compareA > compareB ? 1 : -1;
                            } else {
                                return compareA < compareB ? 1 : -1;
                            }
                        });
                    }

                    return sortedArray;
                    console.log("Sorted Products IDs:", this.sortedFilteredProducts.map(product => product.id));
                },
            },

        });
        $('#menu-btn').click(function () {
            $('nav .navigation ul').addClass('active')
        });
        $('#menu-close').click(function () {
            $('nav .navigation ul').removeClass('active')
        });


    </script>
</body>

</html>